(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{953:function(a,e,s){"use strict";s.r(e);var t=s(73),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"ssl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssl"}},[a._v("#")]),a._v(" ssl")]),a._v(" "),s("p",[a._v("k3/8s 部署部署证书；")]),a._v(" "),s("p",[a._v("说到免费的SSL证书，大家首先想到的肯定是Let’s Encrypt，而使用过Let’s Encrypt的同学应该也知道，其有效期只有三个月，三个月后要重新续期。github上也有类似的脚本可以做到自动续期。那如果是在k8s上使用该免费证书，又如何操作的呢？这里cert-manager就派上用场了。")]),a._v(" "),s("h3",{attrs:{id:"安装cert-manager"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装cert-manager"}},[a._v("#")]),a._v(" 安装cert-manager")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/v1.6.1/cert-manager.crds.yaml\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("helm repo add jetstack https://charts.jetstack.io\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("helm repo update\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl create namespace cert-manager\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("helm install  cert-manager jetstack/cert-manager --namespace cert-manager --version v1.6.1\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl get pods -n cert-manager -w\n")])])]),s("h3",{attrs:{id:"创建、部署-cluster-issuer-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建、部署-cluster-issuer-yaml"}},[a._v("#")]),a._v(" 创建、部署 cluster-issuer.yaml")]),a._v(" "),s("h4",{attrs:{id:"yaml-文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yaml-文件"}},[a._v("#")]),a._v(" yaml 文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("## cluster-issuer.yaml\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-prod\nspec:\n  acme:\n    server: https://acme-v02.api.letsencrypt.org/directory\n    email: 1970305447@qq.com\n    privateKeySecretRef:\n      name: letsencrypt-prod\n    solvers:\n      - http01:\n          ingress:\n            class: traefik\n\n")])])]),s("h4",{attrs:{id:"部署-cluster-issuer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署-cluster-issuer"}},[a._v("#")]),a._v(" 部署 cluster-issuer")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl apply - f cluster-issuer.yaml\n")])])]),s("h3",{attrs:{id:"b-cert-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#b-cert-yaml"}},[a._v("#")]),a._v(" b-cert.yaml")]),a._v(" "),s("h4",{attrs:{id:"创建、部署-b-cert-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建、部署-b-cert-yaml"}},[a._v("#")]),a._v(" 创建、部署 b-cert.yaml")]),a._v(" "),s("h4",{attrs:{id:"yaml-文件-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yaml-文件-2"}},[a._v("#")]),a._v(" yaml 文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("## b-cert.yaml\napiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: canyuegongzi.xyz-tls\nspec:\n  secretName: canyuegongzi.xyz-tls\n  issuerRef:\n    name: letsencrypt-prod\n    kind: ClusterIssuer\n  dnsNames:\n    - blog.canyuegongzi.xyz\n    - www.canyuegongzi.xyz\n\n")])])]),s("h4",{attrs:{id:"部署-b-cert-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#部署-b-cert-yaml"}},[a._v("#")]),a._v(" 部署 b-cert.yaml")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("kubectl apply - f b-cert.yaml\n")])])]),s("h3",{attrs:{id:"ingress-启用-ssl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ingress-启用-ssl"}},[a._v("#")]),a._v(" ingress 启用 ssl")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: nginx-ingress\n  namespace: default\n  annotations:\n    kubernetes.io/ingress.class: traefik\nspec:\n  tls:\n    - hosts:\n        - blog.canyuegongzi.xyz               # TLS 域名\n        #- www.canyuegongzi.xyz               # TLS 域名\n      secretName: canyuegongzi.xyz-tls   # 用于存储证书的 Secret 对象名字\n  rules:\n    - host: blog.canyuegongzi.xyz\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n               serviceName: simple-blog-center-clinet-service\n               servicePort: 3002\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);