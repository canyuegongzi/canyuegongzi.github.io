(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{1038:function(s,t,a){"use strict";a.r(t);var n=a(73),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"dns"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dns"}},[s._v("#")]),s._v(" DNS")]),s._v(" "),n("blockquote",[n("p",[s._v("社会犹如一条船，每个人都要有掌舵的准备。——易卜生")])]),s._v(" "),n("h2",{attrs:{id:"本文主要讲解什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#本文主要讲解什么"}},[s._v("#")]),s._v(" 本文主要讲解什么？")]),s._v(" "),n("ul",[n("li",[s._v("什么是 DNS 域名解析？")]),s._v(" "),n("li",[s._v("Node.js DNS 模块两大类别")]),s._v(" "),n("li",[s._v("dns.lookup() 与 dns.resolve() 区别")]),s._v(" "),n("li",[s._v("什么是DNS 解析过程？什么是 DNS 本地解析?")])]),s._v(" "),n("p",[n("strong",[s._v("作者简介")]),s._v("：五月君，Nodejs Developer，慕课网认证作者，热爱技术、喜欢分享的 90 后青年，欢迎关注 "),n("a",{attrs:{href:"https://nodejsred.oss-cn-shanghai.aliyuncs.com/node_roadmap_wx.jpg?x-oss-process=style/may",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nodejs技术栈"),n("OutboundLink")],1),s._v(" 和 Github 开源项目 "),n("a",{attrs:{href:"https://www.nodejs.red",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.nodejs.red"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"什么是-dns"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-dns"}},[s._v("#")]),s._v(" 什么是 DNS？")]),s._v(" "),n("p",[s._v("为了方便记忆，我们通常会通过域名的方式访问网站，例如直接在浏览器地址栏输入 "),n("a",{attrs:{href:"www.nodejs.red"}},[s._v("www.nodejs.red")]),s._v(" 就可得到一个请求响应，但是在计算机网络通信时是只能识别 IP（127.0.0.1） 地址的，为什么我直接输入一串字母就可以访问呢？这背后的功劳就要归功于我们的 “翻译官” DNS 也就是域名系统，它会将我们的域名转换为 IP 地址进行工作。")]),s._v(" "),n("h2",{attrs:{id:"node-js-dns-模块两大类别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node-js-dns-模块两大类别"}},[s._v("#")]),s._v(" Node.js DNS 模块两大类别")]),s._v(" "),n("p",[s._v("DNS 模块是基于 UDP 协议来实现的，在 Node.js 中我们可以通过 require('dns') 载入 DNS 实现域名的解析查询，Node.js DNS 模块分为两大类：一是使用底层操作系统工具进行域名解析，二是链接到一个 DNS 网络服务器执行域名解析")]),s._v(" "),n("h3",{attrs:{id:"一-底层操作工具域名解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一-底层操作工具域名解析"}},[s._v("#")]),s._v(" 一：底层操作工具域名解析")]),s._v(" "),n("p",[s._v("Node.js DNS 模块的 dns.lookup() 方法使用底层操作系统进行域名解析，是不需要经过任何网络通信的。")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" dns "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dns'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ndns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("lookup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nodejs.red'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" family")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'地址: %j 地址族: IPv%s'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" family"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),n("p",[n("strong",[s._v("注意")]),s._v("，如果本地 hosts 文件被修改过了，dns.lookup() 会拿本地 hosts 文件的域名映射，以下我在 hosts 文件里面修改了域名映射，最终输出的结果为 127.0.0.1 hosts 文件修改后的结果。")]),s._v(" "),n("p",[n("strong",[s._v("/etc/hosts")])]),s._v(" "),n("div",{staticClass:"language-hosts extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("127.0.0.1       www.nodejs.red\n")])])]),n("p",[n("strong",[s._v("输出结果")])]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('地址: "127.0.0.1" 地址族: IPv4\n')])])]),n("h3",{attrs:{id:"二-链接到-dns-服务器执行域名解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二-链接到-dns-服务器执行域名解析"}},[s._v("#")]),s._v(" 二：链接到 DNS 服务器执行域名解析")]),s._v(" "),n("p",[s._v("dns 模块中除 dns.lookup() 之外的所有函数，都会连接到实际 DNS 服务器以执行名称解析并始终使用网络执行 DNS 查询，看以下 dns.resolve() 函数与 dns.lookup() 的不同。")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" dns "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dns'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\ndns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'www.nodejs.red'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" records")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("records"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),n("p",[s._v("使用 dns.resolve 会发现即使我们修改了 hosts 文件，也不受影响还是从外部读取正常的地址。")]),s._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下为输出结果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'185.199.108.153'")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'185.199.109.153'")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'185.199.110.153'")]),s._v(",\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'185.199.111.153'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("p",[s._v("通过上面的 API 可以实现一个类似下面的 DNS 域名解析功能也不是很难，感兴趣的可以亲自去实践下，更多 API 也可参考 nodejs 官网 dns 模块。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(796),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"dns-lookup-与-dns-resolve-不同"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dns-lookup-与-dns-resolve-不同"}},[s._v("#")]),s._v(" dns.lookup() 与 dns.resolve() 不同")]),s._v(" "),n("blockquote",[n("p",[s._v("dns.lookup() 是同步的还是异步的？")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("尽管以异步 JavaScript 的角度来调用 dns.lookup()，但在内部 libuv 底层线程池中却是同步的调用 getaddrinfo(3)，所以可能会由于一些不确定因素造成 Node 进程阻塞。")])]),s._v(" "),n("li",[n("p",[s._v("与 dns.lookup() 不同的是 dns.resolve() 这些方法没有使用 getaddrinfo(3)，是通过网络执行的 DNS 查询，始终是保持异步不会对其它进程产生负面影响。")])])]),s._v(" "),n("p",[s._v("注意事项参考：\n"),n("a",{attrs:{href:"http://nodejs.cn/api/dns.html#dns_implementation_considerations",target:"_blank",rel:"noopener noreferrer"}},[s._v("nodejs.cn/api/dns.html#dns_implementation_considerations"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"什么是-dns-解析过程-什么是-dns-本地解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-dns-解析过程-什么是-dns-本地解析"}},[s._v("#")]),s._v(" 什么是 DNS 解析过程？什么是 DNS 本地解析?")]),s._v(" "),n("p",[s._v("当我们访问一个域名 "),n("a",{attrs:{href:"www.nodejs.red"}},[s._v("www.nodejs.red")]),s._v(" 的时候会有一个 DNS 域名系统，会将我们的域名转换为相应的 IP，所经历的步骤大致为：浏览器 DNS 缓存 —> 系统（OS）缓存 -> 路由器缓存 -> ISP DNS 缓存，详细可参考 "),n("a",{attrs:{href:"https://github.com/Q-Angelo/http-protocol/blob/master/docs/dns-process.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("github.com/Q-Angelo/http-protocol/blob/master/docs/dns-process.md"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("DNS 本地解析指的是 "),n("strong",[s._v("系统（OS）缓存")]),s._v(" 这一阶段，在浏览器 DNS 缓存未命中的情况下，会从本地系统的一个 hosts 文件寻找对应 IP。")]),s._v(" "),n("h2",{attrs:{id:"reference"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[s._v("#")]),s._v(" Reference")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://man7.org/linux/man-pages/man3/getaddrinfo.3.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("man7.org/linux/man-pages/man3/getaddrinfo.3.html"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://nodejs.cn/api/dns.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nodejs.cn/api/dns.html"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports},796:function(s,t,a){s.exports=a.p+"assets/img/dns_analysis.bf99fd7d.jpg"}}]);