(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{1065:function(t,s,a){"use strict";a.r(s);var n=a(73),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"达到最佳性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#达到最佳性能"}},[t._v("#")]),t._v(" 达到最佳性能")]),t._v(" "),a("p",[t._v("扩展是浏览器的补充，旨在提供补充和自定义功能。 延缓或损害浏览体验的扩展程序对用户来说是有问题的，并且违背了Chrome 扩展程序的目标。除了一般的良好编码习惯外，开发人员还应遵循这些做法，以确保其扩展以最佳性能运行。")]),t._v(" "),a("h3",{attrs:{id:"尽可能延迟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#尽可能延迟"}},[t._v("#")]),t._v(" 尽可能延迟")]),t._v(" "),a("p",[t._v("直到需要它们再加载资源。 在启动功能中仅包括打开扩展所需的功能。在启动过程中，请勿加载仅在用户点击按钮时才需要的东西，或仅在用户登录后才起作用的功能。")]),t._v(" "),a("h4",{attrs:{id:"管理重要事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理重要事件"}},[t._v("#")]),t._v(" 管理重要事件")]),t._v(" "),a("p",[t._v("高效的后台脚本包含对其扩展很重要的已注册事件。 它们处于休眠状态，直到触发了侦听器，再采取相应的操作，然后返回休眠状态。保持不需要的脚本运行，对系统资源的浪费。")]),t._v(" "),a("p",[t._v("如果可能，应在 manifest 中注册后台脚本，并将其持久性设置为 false。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "name": "High Performance Extension",\n  "description" : "Sleepy Background Script",\n  "version": "1.0",\n  ...\n  "background": {\n   "scripts": ["background.js"],\n   "persistent": false\n  },\n  ...\n}\n')])])]),a("p",[t._v("使扩展程序使用 chrome.webRequest API 劫持或修改网络请求的唯一方法是始终使后台脚本保持活动状态。 webRequest API 与非持久性后台页面不兼容。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "name": "High Performance Extension",\n  "description" : "Persistent Background Script",\n  "version": "1.0",\n  ...\n  "background": {\n    "scripts": ["background.js"],\n    "persistent": true\n  },\n  "permissions": [\n    "webRequest",\n    "webRequestBlocking",\n    "https://<distracting social media site>.com/*"\n  ],\n ...\n }\n')])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onBeforeRequest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("details")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("redirectUrl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://developer.chrome.com/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("urls"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://social.media.distraction.com/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"blocking"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"包含内容脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包含内容脚本"}},[t._v("#")]),t._v(" 包含内容脚本")]),t._v(" "),a("p",[t._v("内容脚本应充当扩展程序的秘密代理，在扩展程序核心执行更繁琐的逻辑的同时，巧妙地读取或修改网页。他们应该有明确的目标，避免在不相关的页面上进行侵入性活动。理想情况下，除了有目的的行为外，内容脚本不应在浏览体验中引起注意。")]),t._v(" "),a("h4",{attrs:{id:"声明目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明目标"}},[t._v("#")]),t._v(" 声明目标")]),t._v(" "),a("p",[t._v("如果扩展程序在不必要的位置或不适当的时间运行内容脚本，可能会导致浏览器运行缓慢，并可能导致功能错误。通过在 manifest 中提供"),a("a",{attrs:{href:"https://developer.chrome.com/match_patterns",target:"_blank",rel:"noopener noreferrer"}},[t._v("匹配模式"),a("OutboundLink")],1),t._v("并在 document_idle 而不是document_start 上运行脚本来避免这种情况。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n  "name": "High Performance Extension",\n  "description" : "Superfly Superlight Content Scripts",\n  "version": "1.0",\n  ...\n  "content_scripts": [\n    {\n      "js": ["content_script.js"],\n      "matches": ["https://developer.chrome.com/*"],\n      "run_at": "document_idle"\n    }\n  ]\n  ...\n}\n')])])]),a("p",[t._v("如果扩展程序仅需要使用用户的操作来访问网页，请以代码方式将其注入。 只有在用户调用时，代码注入才会运行。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("browserAction"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onClicked"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("tab")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tabs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("executeScript")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      code"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'document.body.style.fontSize=\"100px\"'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h4",{attrs:{id:"仅在需要时使用内容脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#仅在需要时使用内容脚本"}},[t._v("#")]),t._v(" 仅在需要时使用内容脚本")]),t._v(" "),a("p",[t._v("许多扩展可能根本不需要内容脚本即可完成所需的功能。使用 declarativeContent API 将为扩展设置规则，以识别何时满足相关条件。这比内容脚本更有效，并且使用的代码更少！")]),t._v(" "),a("p",[t._v("如果扩展需要在用户访问带有 HTML5 < video >元素的网站时向用户显示页面操作，则可以指定声明性规则。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("runtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onInstalled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("declarativeContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onPageChanged"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeRules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("declarativeContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onPageChanged"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addRules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          conditions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("declarativeContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PageStateMatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              css"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"video"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("chrome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("declarativeContent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShowPageAction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"评估代码效率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#评估代码效率"}},[t._v("#")]),t._v(" 评估代码效率")]),t._v(" "),a("p",[t._v("可以将相同的网站性能通用做法应用于扩展，例如异步编程的实现技术以及使代码最少且紧凑。")]),t._v(" "),a("p",[t._v("使用 Lighthouse 之类的工具评估扩展程序的性能，并确定可以在可视扩展程序页面上改进的目标区域。")])])}),[],!1,null,null,null);s.default=e.exports}}]);